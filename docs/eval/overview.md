# Evaluation & Visualization Overview

The evaluation module provides comprehensive tools for analyzing and visualizing embeddings generated by the SimCLR framework. This module helps researchers understand the quality and biological relevance of learned representations.

## Core Functionality

### Embedding Analysis
- **Statistical Metrics**: R², Kruskal-Wallis H test, Spearman correlation
- **Classification Performance**: k-NN accuracy, linear probing results
- **Dimensionality Reduction**: PCA analysis with variance explained
- **Clustering Quality**: Silhouette scores, cluster validation

### Visualization Tools
- **Scatter Plots**: 2D projections with image thumbnails
- **UMAP/t-SNE**: Non-linear dimensionality reduction
- **Embedding Space**: Interactive exploration of feature space
- **Comparative Analysis**: Side-by-side modality comparisons

## Input Requirements

The evaluation tools expect:

### CSV File Format
```csv
filename,species,sex,age,x1,x2,x3,...,x1024
bird_001.jpg,Turdus migratorius,male,adult,0.12,-0.45,0.78,...,0.23
bird_002.jpg,Turdus migratorius,female,adult,-0.34,0.67,-0.12,...,0.89
```

### Required Columns
- **filename**: Path to original image
- **Metadata**: Categorical labels (species, sex, age, etc.)
- **Embeddings**: Feature vectors (x1, x2, ..., xN)

## Analysis Pipeline

### 1. Data Loading
```python
import pandas as pd
df = pd.read_csv('embeddings.csv')
```

### 2. Statistical Analysis
- Compute ANOVA R² scores per dimension
- Run Kruskal-Wallis tests for categorical variables
- Calculate correlation matrices

### 3. Dimensionality Reduction
- Apply PCA to reduce embedding dimensions
- Identify top contributing dimensions
- Compute explained variance ratios

### 4. Visualization Generation
- Create scatter plots for top dimensions
- Generate thumbnail-enhanced visualizations
- Export publication-ready figures

## Key Metrics

### ANOVA R² Score
Measures how well each embedding dimension explains categorical variance:
```
R² = SS_between / SS_total
```

### Kruskal-Wallis H Test
Non-parametric test for differences between groups:
- H-statistic measures group separation
- p-values indicate statistical significance

### Classification Accuracy
Downstream task performance:
- k-NN classification on embeddings
- Linear probe accuracy
- Cross-validation scores

## Visualization Types

### Raw Embedding Space
Plot embeddings in their original high-dimensional space:
- Select top dimensions by R² score
- Color by categorical variables
- Include image thumbnails

### PCA Space
Visualize principal components:
- PC1 vs PC2, PC1 vs PC3, etc.
- Explained variance annotations
- Loadings interpretation

### Comparative Plots
Side-by-side comparisons:
- RGB vs Multispectral embeddings
- Different training configurations
- Species-specific patterns

## Usage Example

```bash
python evaluate.py \
  --csv_path embeddings.csv \
  --image_dir images/ \
  --output_dir results/ \
  --labels species sex age \
  --emb_num 1024 \
  --emb_prefix x \
  --pca_nc 50 \
  --plot_nc 6 \
  --subset_size 200
```

## Output Files

The evaluation generates:
- **Statistical summaries**: CSV files with metrics
- **Visualization plots**: PNG files for each analysis
- **PCA results**: Transformed embeddings and loadings
- **Classification reports**: Accuracy and confusion matrices

## Best Practices

### Data Preparation
1. Ensure consistent embedding dimensions
2. Validate metadata completeness
3. Check for missing or corrupted images
4. Balance categories when possible

### Analysis Strategy
1. Start with overall dataset statistics
2. Focus on biologically relevant categories
3. Compare across different training conditions
4. Validate findings with domain knowledge

### Interpretation Guidelines
- High R² scores indicate informative dimensions
- Significant H-statistics suggest group separation
- Good classification accuracy validates embedding quality
- Clear clustering patterns support biological hypotheses

## Next Steps

- **[Embedding Analysis](embedding-analysis.md)**: Detailed statistical methods
- **[Visualization Tools](visualization.md)**: Advanced plotting options
- **[Statistical Metrics](statistical-metrics.md)**: Comprehensive metric explanations
